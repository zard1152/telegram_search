<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 16px; /* Increase font size */
        }
        .bold-highlight {
            font-weight: bold;
            background-color: darkblue; /* Change background color to dark blue */
            color: white;
        }
        .formatted-json {
            white-space: pre-wrap; /* Enable automatic line wrapping */
        }
        .key-value {
            display: block; /* Display key-value pairs on separate lines */
        }
    </style>
</head>
<body>
    <h1>Formatted JSON Data:</h1>
    <pre id="formatted-json"></pre>

    <script>
        
        const formattedJsonElement = document.getElementById('formatted-json');

        function formatJson(jsonData) {
            // Remove the 'dialogs' key from the jsonData object
            delete jsonData.dialogs;
        
            return Object.entries(jsonData).map(([key, value]) => {
                if (key === 'messages') {
                    return `${key}: [\n${value.map(formatMessage).join('\n')}\n]`;
                } else {
                    return `${key}: ${value}`;
                }
            }).join('\n');
        }
        
        function formatMessage(message) {
            const formattedMessage = Object.entries(message)
                .filter(([key]) => key !== 'dialogs')
                .map(([key, value]) => {
                    if (key === 'message' || key === 'date' || key === 'reply_message' || key === 'web_title' || key === 'web_description') {
                        return `<span class="key-value bold-highlight">${key}: ${value}</span>`;
                    } else {
                        return `<span class="key-value">${key}: ${value}</span>`;
                    }
                }).join(' ');
        
            return `{${formattedMessage}}`;
        }
        
        // Fetch data from output.json and display customized JSON
        fetch('output.json')
            .then(response => response.json())
            .then(json_data => {
                formattedJsonElement.innerHTML = formatJson(json_data);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
        
        function highlightKeywords(text, keywords) {
            keywords.forEach(keyword => {
                const regex = new RegExp(keyword, 'gi');
                text = text.replace(regex, `<span class="highlight">${keyword}</span>`);
            });
            return text;
            }
        
            function displayFormattedJSON() {
            // 从config.json文件中获取关键字
            fetch('config.json')
                .then(response => response.json())
                .then(config => {
                const keywordsString = config.highlight;
                const keywords = keywordsString.split('|'); // 将字符串拆分成数组
        
                // Fetch data from output.json and display messages
                fetch('output.json')
                    .then(response => response.json())
                    .then(json_data => {
                    const formattedText = JSON.stringify(json_data, null, 4);
                    const highlightedText = highlightKeywords(formattedText, keywords);
                    document.getElementById('formatted-json').innerHTML = highlightedText;
                    })
                    .catch(error => {
                    console.error('Error fetching data:', error);
                    });
                });
            }
        
            displayFormattedJSON();
            
    </script>
</body>
</html>